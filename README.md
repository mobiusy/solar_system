# 太阳系高精度三维模拟器

## 1. 项目概述

### 1.1 项目背景

本项目是一个基于浏览器的**太阳系高精度三维模拟器**，结合 **NASA 行星轨道参数** 与 **three.js** 三维渲染引擎，用于可视化展示：

- 太阳、八大行星以及月球
- 开普勒近似下的椭圆轨道与公转周期
- 行星尺寸、自转轴倾角以及基础物理参数

项目目标是提供一个**兼顾物理合理性与实时性能的交互式教学可视化工具**。

### 1.2 主要功能

- **三维轨道可视化**：基于 NASA 公开数据的太阳—行星—月球系统椭圆轨道。
- **时间控制**：可调节模拟时间流速，支持减速、暂停、快进与反向播放。
- **轨道控制**：切换轨道显示开关，并独立调节轨道视觉缩放比例。
- **自动跟踪视角**：自动跟踪指定天体的运动。
- **地球昼夜纹理**：切换地球白天与夜晚纹理。
- **尺寸映射模式**：在 **对数半径映射** 与 **真实比例** 之间切换，以平衡可视性与真实感。
- **光照模式**：
  - `教学光照`：通过自发光纹理强化表面细节。
  - `真实光照`：更接近真实光照对比度。

当前 `index.html` 中的 UI 语言为**简体中文**，但整体代码与架构适合后续国际化扩展。

---

## 2. 技术栈说明

### 2.1 前端

- **核心库**：[`three`](https://threejs.org/) `0.161.0`，通过 CDN 以 ES Modules 形式加载（`index.html:363-373`）
- **渲染相关**：`THREE.WebGLRenderer`、`THREE.Scene`、`THREE.PerspectiveCamera`、`THREE.Points` 等（`app.js:1-150`）
- **相机交互**：`OrbitControls`，来自 `three/examples/jsm/controls/OrbitControls.js`（`app.js:2`）
- **数据层**：静态轨道与物理参数定义在 `ORBIT_DATA` 中，可视化缩放常量定义在 `VISUAL_SCALE` 中（`orbit-data.js:1-147`）

前端代码不再依赖本地 `node_modules` 目录，也不再需要通过 `npm` 安装 `three`，所有 three.js 相关模块均由 CDN 提供。

### 2.2 辅助脚本

- **Python 3**：
  - `serve.py`：简单 HTTP 静态服务器，修正 `.js/.mjs` 的 MIME 类型，将项目服务于 `http://localhost:4175/`（`serve.py:1-23`）。

### 2.3 运行环境

- 支持 WebGL 的现代桌面浏览器（Chrome / Edge / Firefox 等）
- Python 3.x（用于辅助脚本）

---

## 3. 环境要求与依赖项

### 3.1 系统环境要求

| 组件        | 推荐版本                       | 说明                                |
|-------------|--------------------------------|-------------------------------------|
| 操作系统    | Windows / macOS / Linux        | 能运行 Python 与现代浏览器即可     |
| 浏览器      | 最新 Chrome / Edge / Firefox   | 必须支持 WebGL                      |
| Node.js     | ≥ 18（推荐使用 LTS）           | 可选，用于管理 `three` 依赖         |
| Python      | ≥ 3.8                          | 用于运行仓库中的辅助脚本            |

### 3.2 项目依赖

- **前端依赖**：
  - three.js 通过 CDN 加载，当前使用版本 `0.161.0`（`index.html:363-373`）
- **Python 仅使用标准库**：
  - `http.server`、`socketserver`、`mimetypes`（`serve.py:1-12`）
  
当前项目不再包含 `package.json`，也未定义任何 `npm` 脚本或自动化测试命令，如需测试可通过浏览器控制台调用 `SolarSystemTest.runAll()`（`app.js:911-1004`）。

---

## 4. 安装与部署指南

当前仓库已经包含完整的纹理资源，通常只需完成以下步骤即可运行项目。

### 4.1 克隆仓库

```bash
git clone <your-repo-url> solar_system
cd solar_system
```

> 请将 `<your-repo-url>` 替换为实际仓库地址。

### 4.2 启动本地 HTTP 服务器

为确保 `.js` 与 `.mjs` 文件的 MIME 类型正确，建议使用仓库内的 Python 服务器：

```bash
python serve.py
```

终端应输出类似内容：

```text
Serving HTTP on 0.0.0.0 port 4175 (http://localhost:4175/) ...
```

然后在浏览器中访问：

- `http://localhost:4175/`

此时应能看到 3D 太阳系场景及右侧控制面板。

---

## 5. 使用说明与示例

### 5.1 基本交互

- **旋转视角**：鼠标左键拖拽
- **缩放视图**：鼠标滚轮滚动
- **平移视图**：鼠标右键拖拽
- **选择天体**：点击任一行星或月球，右侧信息面板会显示对应参数

上述交互由 `OrbitControls` 与射线拾取逻辑实现（`app.js:1-120`，`app.js:400-520`）。

### 5.2 控制面板说明

右侧控制面板在 `index.html:247-355` 中定义，包含以下关键控件：

| 控件名称       | 元素 ID             | 功能说明                                                    |
|----------------|---------------------|-------------------------------------------------------------|
| 时间流速       | `time-scale`        | 调节模拟时间流速，`time-scale-label` 显示当前倍率          |
| 轨道显示       | `toggle-orbits`     | 显示 / 隐藏所有轨道线                                      |
| 轨道缩放       | `orbit-scale`       | 调整轨道半径的视觉缩放比例，不影响底层物理参数            |
| 自动跟踪       | `follow-target`     | 相机平滑跟踪所选天体                                      |
| 地球视图切换   | `earth-view-toggle` | 在地球白天与夜晚纹理之间切换                              |
| 尺寸映射模式   | `size-mode`         | 在 `log` 与 `real` 半径映射之间切换                        |
| 光照模式       | `lighting-mode`     | 在 `teaching` 与 `real` 光照预设之间切换                   |

所有控件在 `app.js` 中完成绑定与更新（`app.js:23-76`，`app.js:520-789`）。

### 5.3 时间流速示例

时间流速滑块通过指数映射控制实际模拟速度（`app.js:90-120`）：

- 滑块居中（0）：接近真实时间流速
- 向右拖动：加速时间，使行星快速公转
- 向左拖动：减速直至为负，实现时间倒放

示例操作流程：

1. 启动服务器（`python serve.py`）。
2. 打开页面，找到右侧的**时间流速**滑块。
3. 将滑块向右拖动，观察行星轨道运动明显加快。
4. 将滑块向左拖至负区间，观察轨道反向运行效果。

---

## 6. 贡献指南

### 6.1 代码风格与原则

- **当前环境约定：不新增注释**：在本环境中贡献代码时，应避免主动添加行内注释，除非明确要求。
- **清晰优先于技巧**：使用具备语义的变量名与函数名。
- **数据驱动**：轨道与物理参数尽量集中维护在 `orbit-data.js` 中，而不是散落在渲染逻辑里。
- **避免泄露敏感信息**：不要在仓库中提交任何密钥、令牌或其他机密信息。

### 6.2 推荐贡献方向

- 提升物理精度（如增加更多卫星、细化轨道要素）。
- 改善可视化效果（如星空背景、标注文字、轨迹尾迹等）。
- 为 `index.html` 中的 UI 文本增加多语言 / 国际化支持。
- 引入自动化测试（如使用无头浏览器或对数学工具函数编写单元测试）。

### 6.3 贡献流程建议

1. **Fork** 当前仓库。
2. **创建功能分支**：

   ```bash
   git checkout -b feature/my-improvement
   ```

3. **实现改动** 并确保模拟器仍可正常运行：

   - `python serve.py`
   - 打开 `http://localhost:4175/`

4. **提交代码** 并发起 **Pull Request**，在描述中说明：

   - 主要改动内容
   - 改动动机与收益
   - 对性能或行为的影响

---

## 7. 许可证信息

本项目代码采用 **ISC License** 授权。

简要说明如下：

- 允许以任何目的使用、复制、修改和分发本软件。
- 要求保留原始版权声明。
- 软件按 **“现状”** 提供，不附带任何形式的明示或默示担保。

如需引入第三方资源或库，请确认其许可证与 ISC 兼容，并在必要时进行适当的署名与说明。
